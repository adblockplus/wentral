
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Wentral Project documentation with Markdown.">
      
      
      
      
        <meta name="author" content="Eyeo GmBH">
      
      <link rel="shortcut icon" href="../../img/eyeo_like_robot-white-256.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.6">
    
    
      
        <title>Wentral API - Wentral</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6910b76c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#wentral-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Wentral" class="md-header-nav__button md-logo" aria-label="Wentral">
      
  <img src="../../img/eyeo_like_robot-transparent-256.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Wentral
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Wentral API
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Wentral" class="md-nav__button md-logo" aria-label="Wentral">
      
  <img src="../../img/eyeo_like_robot-transparent-256.png" alt="logo">

    </a>
    Wentral
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../cli/" class="md-nav__link">
      Command line usage
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../api/" class="md-nav__link">
      API
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../file-formats/" class="md-nav__link">
      File Formats
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implementing-detectors" class="md-nav__link">
    Implementing detectors
  </a>
  
    <nav class="md-nav" aria-label="Implementing detectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detect-method" class="md-nav__link">
    detect method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch_detect-method" class="md-nav__link">
    batch_detect method
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-web-service" class="md-nav__link">
    Using the web service
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="wentral-api">Wentral API</h1>
<p>This document describes parts of Wentral API that is related to implementing
detectors as well as the web service HTTP API and the Python library for
working with it.</p>
<h2 id="implementing-detectors">Implementing detectors</h2>
<p>Detector API is specified in <code>wentral.detector</code>. This module also provides
a base class for detectors (although detector implementations are not required
to inherit it as long as they implement the API). Basically detectors are
expected to do three things:</p>
<ul>
<li>Accept detector parameters as arguments to <code>__init__</code>. The most common
  parameters are <code>weights_file</code> -- a path to the file containing the model
  weights, <code>confidence_threshold</code> and <code>iou_threshold</code>. There are no particular
  constraints on these parameters other than that it's convenient to use
  standard names provided by Wentral because it makes it easier to pass them
  from the command line.</li>
<li>If a argument of <code>__init__</code> has type signature, it will be used by Wentral
    to convert the argument value before passing it to the constructor.</li>
<li>Implement reasonable <code>__str__</code> method that includes any important parameters.</li>
<li>Implement <code>detect</code> and <code>batch_detect</code> methods (<code>Detector</code> base class provides
  an implementation of <code>batch_detect</code> that calls <code>detect</code> in a loop but
  implementations are encouraged to do <code>batch_detect</code> in parallel when
  possible).</li>
</ul>
<h3 id="detect-method"><code>detect</code> method</h3>
<p>This method takes one image and returns regions detected in it. The arguments
of <code>detect</code> are:</p>
<ul>
<li><code>image</code> -- <code>PIL.Image</code> object that contains the image for region detection.</li>
<li><code>path</code> -- Path/name of the image. Some detectors (e.g.
  <a href="../cli/#special-detectors">json and static</a>) use the path instead of the
  actual image but ML models typically ignore it.</li>
</ul>
<p>It can also take additional arguments that override detector parameters for
this particular call, such as <code>confidence_threshold</code> and <code>iou_threshold</code>.</p>
<p>The return value of <code>detect</code> should be a list of tuples that contains box
coordinates and detection confidence.</p>
<h3 id="batch_detect-method"><code>batch_detect</code> method</h3>
<p>Batch detect does the same for a batch of images. It takes a list of tuples of
<code>image</code> and <code>path</code> plus same additional arguments as <code>detect</code>.</p>
<p>The return value should be an iterator over <code>(path, detections)</code> tuples where
<code>path</code> is the original image path and <code>detections</code> is a list of detections in
the same format as for <code>detect</code>. The order of the return value doesn't have to
be the same as the order of the input. Depending on implementation details
this might be a list or a generator: Wentral is agnostic about this to give
flexibility to the detector implementation.</p>
<h2 id="using-the-web-service">Using the web service</h2>
<p>Client code for Python is provided in <code>wentral.client</code>:</p>
<pre><code>from PIL import Image
import wentral.client as cl

detector = cl.ProxyDetector('http://localhost:8080/')
path = 'path/image.png'
image = Image.open(path)
boxes = detector.detect(image, path)
</code></pre>
<p>To use the web service directly, upload the image to <code>http://host:port/detect</code>
using a POST request with content type <code>multipart/form-data</code>. The field name
should be called <code>image</code>. The result is returned as a JSON document that
contains an object with the following keys:</p>
<ul>
<li><code>size</code> -- An array with width and height of the image.</li>
<li><code>detection_time</code> -- Detection time in seconds.</li>
<li><code>boxes</code> -- Array of arrays that contain detection box coordinates and
  detection confidence.</li>
</ul>
<p>The requests to <code>detect</code> endpoint can also include additional parameters for
the detection process (they are sent as URL parameters):</p>
<ul>
<li><code>confidence_threshold</code> - minimum model confidence for detections to be
  returned (default: 0.5).</li>
<li><code>iou_threshold</code> - IOU above which two detections are considered duplicate and
  only the highest confidence one will be returned (default: 0.4).</li>
<li><code>slicing_threshold</code> - aspect ratio (short side over long side) below which
  the image will be cut into square slices as the model doesn't deal well with
  very non-square images (default: 0.7).</li>
<li><code>slice_overlap</code> - minimal ratio of the slice area that will be overlapped:
  overlaps are necessary to make sure the objects at slice boundaries get
  detected (default: 0.2).</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; <script>document.write(new Date().getFullYear())</script> <a href="https://www.eyeo.com">Eyeo GmBH</a>.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../../assets/javascripts/bundle.7836ba4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>